<script src="//maps.google.com/maps/api/js?key=AIzaSyBRkajFk38d_24oT0mo8rkMWb1_fJHSMW8"></script>
<script src="//cdn.rawgit.com/mahnunchik/markerclustererplus/master/dist/markerclusterer.min.js"></script>
<script src='//cdn.rawgit.com/printercu/google-maps-utility-library-v3-read-only/master/infobox/src/infobox_packed.js' type='text/javascript'></script> <!-- only if you need custom infoboxes -->
<%= params[:lat] %>
<div class="row">
	<div class="col-md-6">
		<% @messages.each_with_index do |message, index| %>
			<div class="panel-group" role="tablist" aria-multiselectable="true">
			  <div class="panel panel-default">
			    <div class="panel-heading" role="tab" id="headingOne">
			      <h4 class="panel-title">
			        <a role="button" data-toggle="collapse" href="#collapse<%= index.to_s %>" aria-expanded="true" aria-controls="collapse<%= index.to_s %>">
			          <%= truncate(message.body, :length => 50) %>
			        </a>
			      </h4>
			    </div>
			    <div id="collapse<%= index.to_s %>" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
			      <div class="panel-body">
							<div class="row">
								<div class="col-md-6">
									<h3><%= link_to "view", message_path(message.id) %></h3>
									<h3>
										<p> <b> Описание: </b> </p> 
										<p>	<%= message.body %>  </p>
										<hr>
										<p>Status: 
										<b>	<%= message.status %></b></p>
									</h3>
									<%= render partial: 'change_status', locals: { message: message } %>
									<hr>
									<% message.images.each do |image| %>
										<%= image_tag(image.image_url(:actual), class: 'problem_image img-rounded') %>
									<% end %>
									<hr>
									<%= link_to 'Удалить сообщение', archiving_messages_path(message), method: :post, class: 'btn btn-danger' %>
								</div>
							</div>
			      </div>
			    </div>
			  </div>
			</div>
		<% end %>
	</div>


  <div class="col-md-6">
    <div class="jumbotron" style='width: 715px;'>
      <div id="map" style='width: 600px; height: 450px;'></div>
    </div>
  </div>

</div>

<script type="text/javascript">
    handler = Gmaps.build('Google');
    handler.buildMap({ provider: {mapTypeId: 'hybrid'}, internal: {id: 'map'}}, function(){
        markers = handler.addMarkers(<%=raw @hash.to_json %>);
        handler.bounds.extendWith(markers);
        handler.fitMapToBounds();
    });
</script>
